# Модуль для работы с DummyJSON API

Данный модуль предоставляет инструменты для получения данных из [DummyJSON API](https://dummyjson.com/), 
их обработки и сохранения в локальную базу данных SQLite.

## Описание задачи

Модуль разработан в соответствии с техническим заданием:
> Используя сайт https://dummyjson.com/docs/products сделать по API добавление, получение с сохранением в базе всех продуктов "iPhone". Желательно сделать так, чтобы можно было быстро сделать потом и для recipes, posts, users.

## Функциональность

Модуль обеспечивает следующие возможности:
1. Получение данных через HTTP-запросы к API
2. Обработка полученных данных и приведение их к структурированному виду
3. Сохранение данных в локальную SQLite базу данных
4. Просмотр сохранённых данных в удобном текстовом формате

## Структура модуля

Модуль состоит из двух основных компонентов:

1. **processor.py** - скрипт для получения и обработки данных:
   - Загружает данные из API
   - Создаёт таблицы в БД, если они не существуют
   - Сохраняет полученные данные
   - Реализует модульную архитектуру для расширяемости

2. **view_db.py** - утилита для просмотра данных:
   - Отображает структуру и содержимое таблиц БД
   - Предоставляет возможность просмотра конкретной таблицы
   - Форматирует данные для удобного чтения

## Поддерживаемые типы данных

Модуль реализует работу со следующими типами данных:
- **Продукты** (products) - поиск и сохранение информации о товарах
- **Пользователи** (users) - получение и сохранение данных о пользователях
- **Посты** (posts) - загрузка и сохранение сообщений пользователей

Архитектура модуля позволяет легко добавлять поддержку новых типов данных по аналогии (recipes, comments и т.д.).

## Использование

### Получение и сохранение данных

```bash
# Запуск из корня проекта
python dummy/processor.py

# Запуск с очисткой базы данных перед выполнением (удаление старого файла БД)
python dummy/processor.py --clean
```

По умолчанию при запуске скрипт:
- Загружает продукты по запросу "iPhone"
- Получает и сохраняет первых 20 пользователей
- Загружает и сохраняет первые 30 постов

### Просмотр данных в базе

```bash
# Просмотр всех таблиц и данных
python dummy/view_db.py

# Просмотр конкретной таблицы (например, products, post, users)
python dummy/view_db.py --table products

# Указание пути к файлу БД
python dummy/view_db.py --db путь/к/базе.db
```

## Особенности реализации

1. **Поиск продуктов**
   - Используется метод `/products/search?q=iPhone` для поиска продуктов с "iPhone" в названии
   - API возвращает только те продукты, где слово "iPhone" встречается в названии или описании

2. **Получение пользователей**
   - Используется метод `/users?limit=20` для получения первых 20 пользователей
   - Данные включают информацию о профиле, адресе, банковских реквизитах и т.д.

3. **Получение постов**
   - Используется метод `/posts?limit=30` для получения первых 30 постов
   - Тексты постов сохраняются вместе с метаданными (теги, автор и т.д.)

## Расширение функциональности

Для добавления поддержки нового типа данных (например, recipes) необходимо:

1. Создать функцию `process_recipes()` в файле `processor.py` по аналогии с существующими
2. Определить схему таблицы и список колонок
3. При необходимости добавить вызов функции в основной блок скрипта

Пример:
```python
def process_recipes(limit: int = 10, skip: int = 0):
    """Получает и сохраняет данные о рецептах"""
    # Реализация функции аналогична имеющимся
```

## Решение проблем

### Если данные не отображаются в базе

1. Проверьте, что скрипт `processor.py` выполнен без ошибок
2. Запустите скрипт с флагом `--clean` для пересоздания базы данных
3. Убедитесь, что файл БД доступен для записи
4. Проверьте логи на наличие ошибок подключения или API-запросов

### Если видны повторяющиеся структуры таблиц

Это может указывать на проблему в утилите просмотра. Попробуйте:
```bash
# Просмотр отдельной таблицы
python dummy/view_db.py --table posts
```

## Зависимости

Для работы модуля требуются следующие библиотеки:
- requests (для HTTP-запросов)
- sqlite3 (встроен в Python)
- json (встроен в Python)
- logging (встроен в Python)

## Примечания

- Модуль использует SQLite для хранения данных, поэтому не требует установки отдельной СУБД
- Все данные сохраняются в файл `dummy_data.db`
- Используется механизм `INSERT OR IGNORE`, который предотвращает создание дубликатов записей
- Для обработки сложных структур данных (массивы, объекты) используется сериализация в JSON-строки 